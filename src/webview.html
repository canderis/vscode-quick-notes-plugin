<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<!--
        Use a content security policy to only allow loading images from https or from our extension directory,
        and only allow scripts that have a specific nonce.
    -->
		<meta
			http-equiv="Content-Security-Policy"
			content="img-src https: data:; style-src 'unsafe-inline' {{cspSource}}; script-src 'unsafe-inline' {{cspSource}};"
		/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link href="{{styleResetUri}}" rel="stylesheet" />
		<link href="{{styleVSCodeUri}}" rel="stylesheet" />
		<link href="{{styleMainUri}}" rel="stylesheet" />
		<script>
			console.log('Webview script loaded');
			const tsvscode = acquireVsCodeApi();

			// Wait for DOM to be ready
			document.addEventListener('DOMContentLoaded', () => {
				const textarea = document.getElementById('notes-textarea');
				const statusElement = document.getElementById('status');
				let saveTimeout;

				console.log('Textarea found:', textarea);
				console.log('Status found:', statusElement);

				// Auto-save on text change
				textarea.addEventListener('input', () => {
					if (saveTimeout) {
						clearTimeout(saveTimeout);
					}
					saveTimeout = setTimeout(() => {
						console.log('Sending save message:', textarea.value.substring(0, 50) + '...');
						tsvscode.postMessage({
							type: 'saveNotes',
							value: textarea.value,
						});
						showStatus('Notes saved');
					}, 1000);
				});

				// Handle messages from extension
				console.log('Setting up message listener');
				window.addEventListener('message', (event) => {
					const message = event.data;
					console.log('Webview received message:', message);
					if (message.type === 'test') {
						console.log('Test message received:', message.value);
						showStatus('Test message received');
					} else if (message.type === 'loadNotes') {
						console.log('Loading notes into textarea:', message.value);
						textarea.value = message.value || '';
						showStatus('Notes loaded');
					}
				});

				function showStatus(message) {
					statusElement.textContent = message;
					statusElement.classList.add('show');
					setTimeout(() => {
						statusElement.classList.remove('show');
					}, 2000);
				}
			});
		</script>
		<style nonce="{{nonce}}">
			body {
				font-family: var(--vscode-font-family);
				font-size: var(--vscode-font-size);
				font-weight: var(--vscode-font-weight);
				color: var(--vscode-foreground);
				background-color: var(--vscode-editor-background);
				margin: 0;
				padding: 16px;
				box-sizing: border-box;
			}

			.notes-container {
				display: flex;
				flex-direction: column;
				height: 100vh;
				max-width: 100%;
			}

			.notes-header {
				margin-bottom: 16px;
				padding-bottom: 12px;
				border-bottom: 1px solid var(--vscode-panel-border);
			}

			.notes-title {
				font-size: 18px;
				font-weight: 600;
				color: var(--vscode-foreground);
				margin: 0 0 8px 0;
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.notes-title::before {
				content: 'üìù';
				font-size: 16px;
			}

			.notes-description {
				color: var(--vscode-descriptionForeground);
				font-size: 13px;
				margin: 0;
				line-height: 1.4;
			}

			.notes-textarea {
				flex: 1;
				width: 100%;
				min-height: 300px;
				padding: 12px;
				border: 1px solid var(--vscode-input-border);
				border-radius: 4px;
				background-color: var(--vscode-input-background);
				color: var(--vscode-input-foreground);
				font-family: var(--vscode-editor-font-family);
				font-size: var(--vscode-editor-font-size);
				line-height: 1.5;
				resize: vertical;
				outline: none;
				transition: border-color 0.2s ease;
				box-sizing: border-box;
			}

			.notes-textarea:focus {
				border-color: var(--vscode-focusBorder);
				box-shadow: 0 0 0 1px var(--vscode-focusBorder);
			}

			.notes-textarea::placeholder {
				color: var(--vscode-input-placeholderForeground);
			}

			.status-indicator {
				position: fixed;
				bottom: 16px;
				right: 16px;
				background-color: var(--vscode-badge-background);
				color: var(--vscode-badge-foreground);
				padding: 6px 12px;
				border-radius: 4px;
				font-size: 12px;
				font-weight: 500;
				opacity: 0;
				transition: opacity 0.3s ease;
				pointer-events: none;
				z-index: 1000;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
			}

			.status-indicator.show {
				opacity: 1;
			}

			.notes-footer {
				margin-top: 12px;
				padding-top: 12px;
				border-top: 1px solid var(--vscode-panel-border);
				font-size: 11px;
				color: var(--vscode-descriptionForeground);
				text-align: center;
			}

			/* Scrollbar styling to match VS Code */
			.notes-textarea::-webkit-scrollbar {
				width: 8px;
			}

			.notes-textarea::-webkit-scrollbar-track {
				background: var(--vscode-scrollbarSlider-background);
			}

			.notes-textarea::-webkit-scrollbar-thumb {
				background: var(--vscode-scrollbarSlider-background);
				border-radius: 4px;
			}

			.notes-textarea::-webkit-scrollbar-thumb:hover {
				background: var(--vscode-scrollbarSlider-hoverBackground);
			}

			.notes-textarea::-webkit-scrollbar-thumb:active {
				background: var(--vscode-scrollbarSlider-activeBackground);
			}
		</style>
	</head>
	<body>
		<script src="{{scriptUri}}"></script>
		<div class="notes-container">
			<div class="notes-header">
				<h1 class="notes-title">Quick Notes</h1>
				<p class="notes-description">
					Keep your thoughts organized with persistent notes that sync across projects
				</p>
			</div>
			<textarea
				class="notes-textarea"
				id="notes-textarea"
				placeholder="Start typing your notes here... Your notes are automatically saved as you type."
			></textarea>
			<div class="notes-footer">Auto-saved ‚Ä¢ Press Ctrl+S to save manually</div>
			<div class="status-indicator" id="status">Notes saved</div>
		</div>
	</body>
</html>
