<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<!--
        Use a content security policy to only allow loading images from https or from our extension directory,
        and only allow scripts that have a specific nonce.
    -->
		<meta
			http-equiv="Content-Security-Policy"
			content="img-src https: data:; style-src 'unsafe-inline' {{cspSource}}; script-src 'nonce-{{nonce}}' {{cspSource}};"
		/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script nonce="{{nonce}}">
			// Wait for DOM to be ready
			document.addEventListener('DOMContentLoaded', () => {
				const tsvscode = acquireVsCodeApi();
				const textarea = document.getElementById('notes-textarea');
				const statusElement = document.getElementById('status');
				let saveTimeout;
				let isInitialized = false;

				// Auto-save on text change
				textarea.addEventListener('input', () => {
					if (saveTimeout) {
						clearTimeout(saveTimeout);
					}
					saveTimeout = setTimeout(() => {
						tsvscode.postMessage({
							type: 'saveNotes',
							value: textarea.value,
						});
						// Check if status messages are enabled (default to true for backward compatibility)
						if (window.showStatusMessages !== false) {
							showStatus('Notes saved');
						}
					}, 1000);
				});

				// Handle messages from extension
				window.addEventListener('message', (event) => {
					const message = event.data;
					if (message.type === 'loadNotes') {
						textarea.value = message.value || '';
						// Store the setting globally for use in save operations
						window.showStatusMessages = message.showStatusMessages !== false;
						// Handle header visibility
						const headerElement = document.querySelector('.notes-header');
						if (headerElement) {
							if (message.showHeader === false) {
								headerElement.classList.add('hidden');
							} else {
								headerElement.classList.remove('hidden');
							}
						}
						if (window.showStatusMessages && !isInitialized) {
							showStatus('Notes loaded');
						}
						isInitialized = true;
					}
				});

				// Request notes to be loaded when the webview is ready
				tsvscode.postMessage({ type: 'loadNotes' });

				function showStatus(message) {
					statusElement.textContent = message;
					statusElement.classList.add('show');
					setTimeout(() => {
						statusElement.classList.remove('show');
					}, 2000);
				}
			});
		</script>
		<style nonce="{{nonce}}">
			* {
				box-sizing: border-box;
				margin: 0;
				padding: 0;
			}
			body {
				font-family: var(--vscode-font-family);
				font-size: var(--vscode-font-size);
				color: var(--vscode-foreground);
				padding: 16px;
				transform: translateZ(0);
				height: 100vh;
			}

			.notes-container {
				display: flex;
				flex-direction: column;
				height: 100%;
				max-width: 100%;
				overflow: hidden;
			}
			.notes-header {
				margin-bottom: 16px;
				padding-bottom: 12px;
				border-bottom: 1px solid var(--vscode-panel-border);
				transition:
					opacity 0.2s ease,
					margin 0.2s ease,
					padding 0.2s ease,
					height 0.2s ease;
			}
			.notes-header.hidden {
				opacity: 0;
				margin-bottom: 0;
				padding-bottom: 0;
				border-bottom: none;
				height: 0;
				overflow: hidden;
			}
			.notes-title {
				font-size: 18px;
				font-weight: 600;
				color: var(--vscode-foreground);
				margin: 0 0 8px;
				display: flex;
				align-items: center;
				gap: 8px;
			}
			.notes-title::before {
				content: 'üìù';
				font-size: 16px;
			}
			.notes-description {
				color: var(--vscode-descriptionForeground);
				font-size: 13px;
				margin: 0;
				line-height: 1.4;
			}

			.notes-textarea {
				flex: 1;
				width: 100%;
				min-height: 300px;
				padding: 12px;
				border: 1px solid var(--vscode-input-border);
				border-radius: 4px;
				background: var(--vscode-input-background);
				color: var(--vscode-input-foreground);
				font-family: var(--vscode-editor-font-family);
				font-size: var(--vscode-editor-font-size);
				line-height: 1.5;
				resize: none;
				outline: 0;
				transition: border-color 0.2s ease;
				contain: layout style paint;
				will-change: contents;
			}
			.notes-textarea:focus {
				border-color: var(--vscode-focusBorder);
				box-shadow: 0 0 0 1px var(--vscode-focusBorder);
			}
			.notes-textarea::placeholder {
				color: var(--vscode-input-placeholderForeground);
			}

			.status-indicator {
				position: fixed;
				bottom: 16px;
				right: 16px;
				background: var(--vscode-badge-background);
				color: var(--vscode-badge-foreground);
				padding: 6px 12px;
				border-radius: 4px;
				font-size: 12px;
				font-weight: 500;
				opacity: 0;
				transition: opacity 0.3s ease;
				pointer-events: none;
				z-index: 1000;
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
			}
			.status-indicator.show {
				opacity: 1;
			}
			.notes-footer {
				margin-top: 12px;
				padding-top: 12px;
				border-top: 1px solid var(--vscode-panel-border);
				font-size: 11px;
				color: var(--vscode-descriptionForeground);
				text-align: center;
			}

			.notes-textarea::-webkit-scrollbar {
				width: 8px;
			}
			.notes-textarea::-webkit-scrollbar-track {
				background: var(--vscode-scrollbarSlider-background);
			}
			.notes-textarea::-webkit-scrollbar-thumb {
				background: var(--vscode-scrollbarSlider-background);
				border-radius: 4px;
			}
			.notes-textarea::-webkit-scrollbar-thumb:hover {
				background: var(--vscode-scrollbarSlider-hoverBackground);
			}
			.notes-textarea::-webkit-scrollbar-thumb:active {
				background: var(--vscode-scrollbarSlider-activeBackground);
			}
		</style>
	</head>
	<body>
		<div class="notes-container">
			<div class="notes-header">
				<h1 class="notes-title">Quick Notes</h1>
				<p class="notes-description">
					Keep your thoughts organized with persistent notes that sync across projects
				</p>
			</div>
			<textarea
				class="notes-textarea"
				id="notes-textarea"
				placeholder="Start typing your notes here... Your notes are automatically saved as you type."
			></textarea>
			<div class="status-indicator" id="status">Notes saved</div>
		</div>
	</body>
</html>
